<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="/plantilla.xhtml" 
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
    <ui:define name="title">Agenda Diario Sur - Evento</ui:define>
    <ui:define name="subtitulo">Evento</ui:define>

    <ui:define name="content">
        <f:metadata>
            <f:viewParam name="evento" value="#{evento.eventId}"/>
            <f:viewParam name="commentPage" value="#{evento.commentPage}"/>
            <f:viewAction action="#{evento.onLoad()}" />
        </f:metadata>
        <h:outputStylesheet name="css/evento.css" />

        <c:choose>
            <c:when test="#{evento.validado}">
                <p:panel header="#{evento.evento.nombre}">
                    <h:panelGrid columns="1" style="margin: 0 auto;">

                        <h:panelGrid columns="2">
                            <h:panelGroup>
                                <p:galleria value="#{evento.imagenes}" var="image" 
                                            autoPlay="true" effect="fade">
                                    <p:graphicImage
                                        title="#{image}" alt="#{image}"
                                        width="100%" height="100%" value="#{image}">
                                    </p:graphicImage>
                                </p:galleria>
                            </h:panelGroup>
                            <h:panelGroup>
                                <p:panel>
                                    <h:panelGrid columns="2">
                                        <h3>Fechas</h3>
                                        <p:scrollPanel mode="native" style="width:250px;height:200px">
                                            <p:orderList value="#{evento.evento.fechas}" var="fecha" disabled="true" controlsLocation="none" styleClass="listaFechas" 
                                                         itemLabel="#{fecha.toLocalDate().toString()}" 
                                                         itemValue="#{fecha.toLocalDate().toString()}" />
                                        </p:scrollPanel>
                                    </h:panelGrid>
                                    <h:panelGrid columns="2">
                                        <h:panelGroup>
                                            <p>Precio: #{evento.evento.precio}€</p>
                                            <p:button value="Comprar" outcome="compraEntradas.xhtml?evento=#{evento.eventId}" />
                                            <br></br>
                                            <h:form>
                                                <p:commandButton value="Favoritos #{evento.numeroFavoritos()}" 
                                                                 action="#{evento.marcarFavorito()}" />
                                            </h:form>
                                        </h:panelGroup>
                                        <h:panelGroup>
                                            <!-- Boton para popup de compartir a facebook o twitter -->
                                            <p:button styleClass="shareButton" value="Compartir Twitter" onclick="return shareTwitter('#{evento.currentUrl}')"/>
                                            <br></br>
                                            <p:button styleClass="shareButton" value="Compartir Facebook" onclick="return shareFacebook('#{evento.eventId}')"/>
                                        </h:panelGroup>
                                    </h:panelGrid>
                                </p:panel>
                            </h:panelGroup>
                        </h:panelGrid>

                        <p:panel header="Descripcion" styleClass="descripcionEvento">
                            <h:outputLink value="#{evento.evento.URLOrganizador}">#{evento.evento.organizador}</h:outputLink>
                            <br></br>
                            <h:outputText value="#{evento.evento.descripcion}"/>
                        </p:panel>

                        <c:if test="#{not empty evento.evento.geolocalizacion}">
                            <p:panel header="Ubicacion">
                                <p:gmap center="#{evento.evento.geolocalizacion}" zoom="15" type="hybrid" 
                                        style="width:100%;height:200px" model="#{evento.model}"/>
                            </p:panel>
                        </c:if>

                        <h:panelGrid columns="1" style="margin: 0 auto;">
                            <h:panelGroup>
                                <p:panel style="overflow-y: auto; margin: 0 auto;" header="Comentarios">
                                    <!-- ui repeat o datatable -->
                                    <ui:repeat value="#{evento.calificaciones}" var="cal">
                                        <p:panel styleClass="comentario" header="#{cal.titulo}">
                                            <h4>Usuario: #{cal.usuarios.nombre}</h4>
                                            <p>#{cal.comentario}</p>
                                            <p>Calificacion: #{cal.puntuacion}</p>
                                            <c:if test="#{empty cal.imagen}">
                                                <p:graphicImage value="#{cal.imagen}"/>
                                                <h:outputText value="imagen: #{cal.imagen}"/>
                                            </c:if>
                                        </p:panel>
                                    </ui:repeat>
                                    <c:if test="#{evento.hasMoreComments}">
                                        <p:commandButton value="Cargar Mas" action="#{evento.nextCommentPage()}"></p:commandButton>
                                    </c:if>
                                </p:panel>
                            </h:panelGroup>
                            <h:panelGroup>
                                <p:panel header="Escribir Reseña" styleClass="containerResenia">
                                    <h:form enctype="multipart/form-data" id="comentario" onsubmit="return validate()">
                                        <h:panelGrid columns="2">
                                            <h:outputText value="Puntuacion:"/>
                                            <p:rating value="#{evento.calificacion.puntuacion}" stars="5"/>
                                        </h:panelGrid>
                                        <h:panelGrid columns="1">
                                            <p:inputText id="title" value="#{evento.calificacion.titulo}" placeholder="Introduce el titulo"/>
                                            <p:inputTextarea id="texto" value="#{evento.calificacion.comentario}" placeholder="Introduce el comentario..."/>
                                            <p:fileUpload
                                                allowTypes="/(\.|\/)(gif|jpe?g|png)$/"
                                                multiple="false"
                                                value="#{evento.imagen}"
                                                mode="simple"
                                                ></p:fileUpload>
                                        </h:panelGrid>
                                        <h:panelGrid columns="2">
                                            <p:commandButton value="Enviar" ajax="false" action="#{evento.enviarCalificacion()}"/>
                                            <p:commandButton value="Reestablecer" type="reset"/>
                                        </h:panelGrid>
                                    </h:form>
                                </p:panel>
                            </h:panelGroup>
                        </h:panelGrid>

                    </h:panelGrid>

                </p:panel>
            </c:when>
            <c:otherwise>
                <h1>EVENT NOT FOUND</h1>
            </c:otherwise>
        </c:choose>

        <script src="http://maps.google.com/maps/api/js?key=AIzaSyD4fLESI4ybh4eJh7NOxFhDxW7uCK2XHDs" type="text/javascript" ></script>
        <script type="text/javascript" src="resources/js/share.js"></script>
        <script type="text/javascript" src="resources/js/evento.js"></script>
    </ui:define>
</ui:composition>

