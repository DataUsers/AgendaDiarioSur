<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="/plantilla.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
                xmlns:jsf="http://xmlns.jcp.org/jsf">
    <ui:define name="title">Agenda Diario Sur - Gestion Evento</ui:define>
    <ui:define name="subtitulo">Gestión eventos</ui:define>
    <ui:define name="content">

        <c:if test="#{gestionEvento.comprobarAutorizacion()}">
            <h:panelGrid columns="1" style="margin: 0 auto;"> <!-- Crear css -->
                <!-- busqueda -->
                <form method="GET" action="gestionEvento.xhtml" onsubmit="">
                    <!-- longitud y latitud para busqueda en la bd -->
                    <!-- filtros -->
                    <h:panelGrid columns="6">
                        <ui:repeat var="filtros" value="#{busqueda.filtros}">
                            <label for="#{filtros}">#{filtros}</label>
                            <input type="radio" id="#{filtros}" name="filtrar" value="#{filtros}" />
                        </ui:repeat>
                    </h:panelGrid>

                    <input type="text" name="q" placeholder="Buscar por nombre, ciudad, tipo..."></input>
                    <input type="submit" id="submitBusq" value="Enviar"></input>
                </form>
                <p:panel header="Gestion Eventos">

                    <h:dataTable id="listaEvento" value="#{gestionEvento.eventosMostrar}" var="event" border="1">
                        <h:column>
                            <p:panel>
                                <h:form>
                                    <h:panelGrid columns="3">
                                        <h:panelGroup>
                                            <!-- imagen -->
                                            <p:graphicImage value="resources/imagenes/#{gestionEvento.randomImage()}"
                                                            width="250px"
                                                            height="200px"/>
                                        </h:panelGroup>
                                        <h:panelGroup>
                                            <p:panel header="Editar #{event.nombre}">
                                                <h:outputLabel value="Nombre"/>
                                                <br></br>
                                                <h:inputText value="#{event.nombre}" />
                                                <br></br>
                                                <h:outputLabel value="Precio"/>
                                                <br></br>
                                                <h:inputText value="#{event.precio}"/>
                                                <br></br>
                                                <h:panelGrid columns="2">
                                                    <p>Fecha</p>
                                                    <!-- funciona esto?? -->
                                                    <input type="date" jsf:value="#{gestionEvento.fecha}" value="#{gestionEvento.placeholderFecha()}"/>
                                                    <input type="time" jsf:value="#{gestionEvento.tiempo}" value="#{gestionEvento.placeholderTiempo()}"/>
                                                </h:panelGrid>
                                                <h3>Descripcion</h3>
                                                <h:inputTextarea label="Descripcion" value="#{event.descripcion}" />                                                
                                            </p:panel>
                                        </h:panelGroup>
                                        <h:panelGroup>
                                            <p:commandButton type="submit" value="Guardar cambios" action="#{gestionEvento.guardarCambios(event)}"/>
                                            <br></br>
                                            <p:button outcome="editEvento.xhtml?evento=10" value="Edicion avanzada"/> <!-- hardcodeado -->
                                            <br></br>
                                            <!-- TEST --> 
                                            <c:if test="#{gestionEvento.comprobarAdmin()}">
                                                <p:commandButton id="delete" action="#{gestionEvento.borrarEvento(event)}"
                                                                 icon="ui-icon ui-icon-trash" 
                                                                 value="Eliminar Evento" 
                                                                 title="EliminarEvento">
                                                    <p:confirm header="Confirmar Eliminar" 
                                                               message="¿Estas seguro de querer eliminar este evento?" 
                                                               icon="ui-icon-alert"/>
                                                </p:commandButton>

                                                <p:confirmDialog global="true" showEffect="fade" hideEffect="explode">
                                                    <p:commandButton title="EliminarSi" value="Yes" styleClass="ui-confirmdialog-yes"/>
                                                    <p:commandButton title="EliminarNo" value="No" styleClass="ui-confirmdialog-no" />
                                                </p:confirmDialog>
                                            </c:if>

                                        </h:panelGroup>
                                    </h:panelGrid>
                                </h:form>
                            </p:panel>
                        </h:column>
                    </h:dataTable>
                </p:panel>
            </h:panelGrid>
        </c:if>

        <c:if test="#{not gestionEvento.comprobarAutorizacion()}">
            <h3>No está autorizado a editar eventos</h3>
        </c:if>

    </ui:define>
</ui:composition>

